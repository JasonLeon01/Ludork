 # Ludork：2D RPG 工具包 - 帮助手册
 ## 节点图可视化脚本

 本章介绍 Ludork 的可视化脚本系统，它围绕**公共函数（Common Functions）**和**节点图编辑器（Node Graph Editor）**构建。通过可视化脚本，你可以在不直接编写 Python 代码的情况下创建并复用玩法逻辑。

 ### 公共函数概览

 **公共函数**是一段以节点图形式表示的可复用逻辑单元：
 - 每个节点负责一个小型操作（数学运算、字符串处理、容器操作等）。
 - 节点之间通过连线连接，定义数据的流动以及操作的大致顺序。
 - 输入与输出则定义了该函数所需的外部信息以及会产生的结果。

 公共函数会以数据文件形式存放在项目 `Data/CommonFunctions` 目录下，可以在游戏的多个地方被调用与复用。

 ### 节点图编辑器

 你通过**节点图编辑器**来创建和编辑公共函数。该编辑器通常包含：
 - 一个用于摆放和连接节点的**图形画布（Graph Canvas）**。
 - 用于选择当前要编辑的公共函数的**函数列表或浏览器**。
 - 用于查看和调整节点属性、输入、输出和参数的面板。

 从使用者的角度看：
 - 画布的交互方式与常见的节点编辑工具类似：拖拽节点到视图中，通过连线连接节点，根据需要整理布局。
 - 编辑器会记录当前激活的公共函数，当你修改节点或连线时，会标记该函数已被修改。

 当你保存时，编辑器会将更新后的图描述写回 `Data/CommonFunctions` 中对应的文件。

 ### 创建与管理公共函数

 要创建一个新的公共函数：
 - 通过编辑器中的公共函数管理窗口创建新的条目。
 - 为该函数起一个清晰且具有描述性的名称。
 - 打开它，进入节点图编辑器进行编辑。

 管理已有函数时，你可以：
 - 通过列表或浏览器快速定位并打开目标函数。
 - 在需要时复制现有函数，以建立基于模板的变体，而不是从零开始。
 - 删除不再使用的函数，并留意更新游戏逻辑中对它们的引用。

 良好的命名与组织习惯，会让项目在公共函数数量增加时仍然易于维护。

 ### 节点类型与类别

 节点图编辑器提供了多种节点类型，通常会按类别进行组织，例如：
 - **数学（Math）**：加减乘除、比较及其他数值运算。
 - **字符串（String）**：拼接、格式化、子串等操作。
 - **容器（Containers）**：列表、字典等数据结构相关操作。
 - **工具（Utils）**：例如裁剪数值、随机数生成等通用工具节点。
 - **项目相关节点（Project-specific Nodes）**：与游戏数据交互的节点，例如地图、角色或 UI 元素。

 在构建公共函数时，你可以：
 - 从上述类别中选择合适的节点来拼装所需行为。
 - 将通用节点（数学、字符串、容器等）与项目相关节点组合起来，实现实际的玩法逻辑。

 ### 输入与输出

 每个公共函数都可以定义：
 - **输入（Inputs）**：在函数运行时从外部传入的值。
 - **输出（Outputs）**：函数计算并返回的结果。

 在节点图编辑器中：
 - 你可以根据函数的设计目标添加或移除输入与输出。
 - 输入节点代表来自外部的值；输出节点用于收集并暴露计算结果。

 清晰的输入与输出设计能显著提升函数的可复用性：
 - 拥有明确输入的函数可以在多个上下文中复用。
 - 拥有明确输出的函数可以被其他逻辑继续利用或用于驱动 UI 与特效。

 ### 流程与执行

 Ludork 的可视化脚本系统是数据驱动的，但许多图中也包含显式或隐式的执行流程。在实践中：
 - 有些节点仅对数据进行处理（例如转换数值、拼接字符串）。
 - 另一些节点可能代表实际的动作或步骤（例如触发某个特效或更新某个值）。

 在节点图编辑器中，你可以：
 - 通过连线构建反映操作顺序的节点布局。
 - 使用比较和分支等条件节点，根据输入数据决定不同的逻辑路径。

 在运行时，引擎会根据节点类型和连接关系对图进行求值，并生成公共函数所定义的输出结果。

 ### 在游戏中使用公共函数

 定义好公共函数之后，它们可以在游戏的各个部分被调用，例如：
 - 作为事件逻辑的一部分。
 - 用于计算伤害、奖励或移动代价等数值。
 - 用来控制特效、过渡或 UI 行为。

 虽然具体调用方式取决于项目中实际的设计，但一般模式是：
 - 你在某个玩法模块中配置将调用指定的公共函数。
 - 当该模块在游戏中运行时，引擎会：
   - 向公共函数提供所需输入。
   - 对节点图进行求值。
   - 使用输出结果来决定后续行为。

 由于公共函数本质上是数据，你可以在编辑器中对它们进行迭代，而无需修改引擎代码。

 ### 组织你的图

 随着项目规模增长，你的公共函数数量往往会持续增加。为了保持可维护性，可以：
 - 通过命名约定对函数进行分组，例如使用 `Battle/`、`UI/`、`Map/` 之类的前缀。
 - 倾向于编写职责单一、结构紧凑的小函数。
 - 在支持的情况下，让函数之间可以相互调用，而不是在多个图中重复相同逻辑。

 这类组织方式会让调试和维护在长周期项目中变得更轻松。

 ### 调试与迭代

 可视化脚本的设计目标就是便于快速迭代：
 - 你可以修改节点图并进行测试，而无需接触底层 Python 代码。
 - 相比纯文本代码，逻辑错误在图形节点中往往更容易被观察出来。

 调试公共函数时，你可以：
 - 利用编辑器中的控制台与日志功能，观察函数运行时游戏的实际行为。
 - 调整节点连接或参数，多次试验，直到行为符合你的预期。

 由于编辑器与运行时共享同一套数据格式，你对节点图的修改可以以较低成本映射到游戏体验中。

