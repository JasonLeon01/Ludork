# -*- encoding: utf-8 -*-

import Engine.Manager as Manager
from Engine import Vector2f, seconds, Color
from Engine.Gameplay import SceneBase
from Engine.Gameplay.Actors import Character
from Engine.Gameplay import Tile, TileLayer, Tilemap, Light, GameMap


class Scene(SceneBase):
    def onCreate(self):
        self.actors = [
            Character(Manager.loadCharacter("actors/classic-cha-braver01.png"), "yongshi"),
            Character(Manager.loadCharacter("actors/020-Braver10.png"), "shilaimu"),
        ]
        for i, actor in enumerate(self.actors):
            actor.setAnimatable(True, True)

        layer = TileLayer(
            "default",
            "magictower.png",
            [
                [
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
            ],
        )

        self.actors[0].setCollisionEnabled(True)
        self.actors[0].setPosition((320, 240))
        self.actors[0].addChild(self.actors[1])
        self.actors[1].animateWithoutMoving = True
        self.actors[1].setRelativePosition((64, -64))

        self._gameMap = GameMap(Tilemap([layer]))
        self._gameMap.setAmbientLight(Color(0, 0, 0, 255))
        self.light = Light(Vector2f(160, 120), Color(255, 220, 180, 255), 32.0)
        self._gameMap.setLights([self.light])

        self._gameMap.spawnActor(self.actors[0], "default")

    def onTick(self, deltaTime: float) -> None:
        if not hasattr(self, "xx"):
            self.xx = 0
        if self.xx < 100:
            self.xx += 1
            self.actors[0].MapMove((0, -1))
        elif self.xx < 200:
            self.xx += 1
            self.actors[0].MapMove((1, 0))
        elif self.xx < 300:
            self.xx += 1
            self.actors[0].MapMove((0, 1))
        elif self.xx < 400:
            self.xx += 1
            self.actors[0].MapMove((-1, 0))
        elif self.xx < 500:
            self.xx = 0
        if self.light.radius < 1280.0:
            self.light.radius += 1
        return super().onTick(deltaTime)

    def _logicHandle(self, deltaTime: float) -> None:
        self._gameMap.onTick(deltaTime)
        super()._logicHandle(deltaTime)
        self._gameMap.onLateTick(deltaTime)

    def _renderHandle(self, deltaTime: float) -> None:
        self._gameMap.show()
        super()._renderHandle(deltaTime)
