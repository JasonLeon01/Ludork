# -*- encoding: utf-8 -*-

import Engine.Manager as Manager
from Engine import Vector2f, seconds
from Engine.Gameplay import SceneBase
from Engine.Gameplay.Actors import Character
from Engine.Gameplay import Tile, TileLayer, Tilemap, GameMap


class Scene(SceneBase):
    def onCreate(self):
        self.actors = [
            Character(Manager.loadCharacter("actors/classic-cha-braver01.png"), "yongshi"),
            Character(Manager.loadCharacter("actors/020-Braver10.png"), "shilaimu"),
        ]
        for i, actor in enumerate(self.actors):
            actor.setAnimatable(True, True)

        layer = TileLayer(
            "default",
            "magictower.png",
            [
                [
                    Tile(78),
                    Tile(147),
                    Tile(50),
                    Tile(83),
                    Tile(56),
                    Tile(106),
                    Tile(86),
                    Tile(10),
                    Tile(36),
                    Tile(89),
                    Tile(44),
                    Tile(32),
                    Tile(117),
                    Tile(29),
                    Tile(33),
                    Tile(59),
                    Tile(91),
                    Tile(60),
                    Tile(93),
                    Tile(74),
                ],
                [
                    Tile(3),
                    Tile(43),
                    Tile(79),
                    Tile(132),
                    Tile(19),
                    Tile(103),
                    Tile(54),
                    Tile(85),
                    Tile(52),
                    Tile(31),
                    Tile(18),
                    Tile(14),
                    Tile(25),
                    Tile(97),
                    Tile(21),
                    Tile(94),
                    Tile(41),
                    Tile(63),
                    Tile(94),
                    Tile(91),
                ],
                [
                    Tile(2),
                    Tile(93),
                    Tile(92),
                    Tile(43),
                    Tile(127),
                    Tile(11),
                    Tile(71),
                    Tile(53),
                    Tile(59),
                    Tile(54),
                    Tile(97),
                    Tile(98),
                    Tile(89),
                    Tile(37),
                    Tile(4),
                    Tile(84),
                    Tile(27),
                    Tile(40),
                    Tile(69),
                    Tile(26),
                ],
                [
                    Tile(0),
                    Tile(52),
                    Tile(67),
                    Tile(53),
                    Tile(126),
                    Tile(19),
                    Tile(67),
                    Tile(60),
                    Tile(5),
                    Tile(24),
                    Tile(73),
                    Tile(159),
                    Tile(108),
                    Tile(42),
                    Tile(46),
                    Tile(91),
                    Tile(128),
                    Tile(21),
                    Tile(39),
                    Tile(57),
                ],
                [
                    Tile(24),
                    Tile(47),
                    Tile(76),
                    Tile(75),
                    Tile(18),
                    Tile(18),
                    Tile(56),
                    Tile(47),
                    Tile(33),
                    Tile(49),
                    Tile(79),
                    Tile(32),
                    Tile(22),
                    Tile(32),
                    Tile(66),
                    Tile(64),
                    Tile(51),
                    Tile(2),
                    Tile(90),
                    Tile(44),
                ],
                [
                    Tile(55),
                    Tile(85),
                    Tile(54),
                    Tile(19),
                    Tile(36),
                    Tile(88),
                    Tile(38),
                    Tile(94),
                    Tile(16),
                    Tile(13),
                    Tile(21),
                    Tile(27),
                    Tile(76),
                    Tile(51),
                    Tile(71),
                    Tile(84),
                    Tile(90),
                    Tile(17),
                    Tile(38),
                    Tile(95),
                ],
                [
                    Tile(9),
                    Tile(117),
                    Tile(47),
                    Tile(20),
                    Tile(49),
                    Tile(76),
                    Tile(31),
                    Tile(93),
                    Tile(18),
                    Tile(79),
                    Tile(23),
                    Tile(14),
                    Tile(19),
                    Tile(61),
                    Tile(58),
                    Tile(17),
                    Tile(88),
                    Tile(90),
                    Tile(11),
                    Tile(79),
                ],
                [
                    Tile(7),
                    Tile(65),
                    Tile(52),
                    Tile(12),
                    Tile(83),
                    Tile(68),
                    Tile(39),
                    Tile(84),
                    Tile(46),
                    Tile(73),
                    Tile(57),
                    Tile(56),
                    Tile(63),
                    Tile(131),
                    Tile(52),
                    Tile(53),
                    Tile(41),
                    Tile(44),
                    Tile(69),
                    Tile(61),
                ],
                [
                    Tile(70),
                    Tile(41),
                    Tile(30),
                    Tile(41),
                    Tile(44),
                    Tile(97),
                    Tile(33),
                    Tile(14),
                    Tile(10),
                    Tile(73),
                    Tile(99),
                    Tile(60),
                    Tile(11),
                    Tile(2),
                    Tile(64),
                    Tile(53),
                    Tile(68),
                    Tile(78),
                    Tile(21),
                    Tile(45),
                ],
                [
                    Tile(60),
                    Tile(75),
                    Tile(22),
                    Tile(94),
                    Tile(12),
                    Tile(63),
                    Tile(95),
                    Tile(68),
                    Tile(21),
                    Tile(36),
                    Tile(96),
                    Tile(16),
                    Tile(17),
                    Tile(86),
                    Tile(93),
                    Tile(29),
                    Tile(81),
                    Tile(48),
                    Tile(101),
                    Tile(77),
                ],
                [
                    Tile(2),
                    Tile(30),
                    Tile(81),
                    Tile(44),
                    Tile(37),
                    Tile(27),
                    Tile(13),
                    Tile(44),
                    Tile(73),
                    Tile(150),
                    Tile(66),
                    Tile(83),
                    Tile(30),
                    Tile(154),
                    Tile(79),
                    Tile(69),
                    Tile(44),
                    Tile(87),
                    Tile(65),
                    Tile(35),
                ],
                [
                    Tile(37),
                    Tile(80),
                    Tile(27),
                    Tile(28),
                    Tile(56),
                    Tile(112),
                    Tile(7),
                    Tile(42),
                    Tile(98),
                    Tile(56),
                    Tile(81),
                    Tile(39),
                    Tile(74),
                    Tile(66),
                    Tile(11),
                    Tile(31),
                    Tile(43),
                    Tile(23),
                    Tile(55),
                    Tile(53),
                ],
                [
                    Tile(74),
                    Tile(67),
                    Tile(100),
                    Tile(52),
                    Tile(15),
                    Tile(58),
                    Tile(85),
                    Tile(32),
                    Tile(42),
                    Tile(18),
                    Tile(93),
                    Tile(81),
                    Tile(21),
                    Tile(18),
                    Tile(37),
                    Tile(41),
                    Tile(62),
                    Tile(31),
                    Tile(45),
                    Tile(77),
                ],
                [
                    Tile(5),
                    Tile(13),
                    Tile(72),
                    Tile(41),
                    Tile(74),
                    Tile(77),
                    Tile(79),
                    Tile(77),
                    Tile(46),
                    Tile(52),
                    Tile(81),
                    Tile(72),
                    Tile(93),
                    Tile(64),
                    Tile(59),
                    Tile(25),
                    Tile(99),
                    Tile(73),
                    Tile(41),
                    Tile(10),
                ],
                [
                    Tile(82),
                    Tile(11),
                    Tile(65),
                    Tile(86),
                    Tile(48),
                    Tile(22),
                    Tile(83),
                    Tile(40),
                    Tile(43),
                    Tile(80),
                    Tile(55),
                    Tile(60),
                    Tile(30),
                    Tile(24),
                    Tile(77),
                    Tile(58),
                    Tile(41),
                    Tile(5),
                    Tile(22),
                    Tile(75),
                ],
            ],
        )

        self.actors[0].setPosition((96, 160))
        self.actors[0].addChild(self.actors[1])
        self.actors[1].animateWithoutMoving = True
        self.actors[1].setRelativePosition((64, -64))

        self._gameMap = GameMap(Tilemap([layer]))

        self._gameMap.spawnActor(self.actors[0], "default")

    def _logicHandle(self, deltaTime: float) -> None:
        self._gameMap.onTick(deltaTime)
        super()._logicHandle(deltaTime)
        self._gameMap.onLateTick(deltaTime)

    def _renderHandle(self, deltaTime: float) -> None:
        self._gameMap.show()
        super()._renderHandle(deltaTime)
