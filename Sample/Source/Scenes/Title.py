# -*- encoding: utf-8 -*-

import Engine.Manager as Manager
from Engine import Vector2f, seconds, Color
from Engine.Gameplay import SceneBase
from Engine.Gameplay.Actors import Character
from Engine.Gameplay import Tile, TileLayer, Tilemap, Light, GameMap


class Scene(SceneBase):
    def onCreate(self):
        self.actors = [
            Character(Manager.loadCharacter("actors/classic-cha-braver01.png"), "yongshi"),
            Character(Manager.loadCharacter("actors/020-Braver10.png"), "shilaimu"),
        ]
        for i, actor in enumerate(self.actors):
            actor.setAnimatable(True, True)

        layer = TileLayer(
            "default",
            "magictower.png",
            [
                [
                    Tile(114),
                    Tile(133),
                    Tile(33),
                    Tile(97),
                    Tile(52),
                    Tile(111),
                    Tile(50),
                    Tile(35),
                    Tile(147),
                    Tile(143),
                    Tile(63),
                    Tile(107),
                    Tile(96),
                    Tile(79),
                    Tile(121),
                    Tile(85),
                    Tile(80),
                    Tile(106),
                    Tile(41),
                    Tile(39, False),
                ],
                [
                    Tile(152),
                    Tile(93),
                    Tile(78),
                    Tile(44),
                    Tile(22),
                    Tile(102),
                    Tile(20),
                    Tile(106),
                    Tile(122),
                    Tile(67),
                    Tile(43),
                    Tile(7),
                    Tile(112),
                    Tile(139),
                    Tile(4),
                    Tile(115),
                    Tile(18),
                    Tile(68),
                    Tile(40, False),
                    Tile(153),
                ],
                [
                    Tile(99),
                    Tile(77),
                    Tile(56),
                    Tile(19),
                    Tile(62),
                    Tile(118),
                    Tile(102),
                    Tile(146),
                    Tile(66),
                    Tile(24),
                    Tile(115),
                    Tile(19),
                    Tile(76),
                    Tile(112),
                    Tile(67),
                    Tile(141),
                    Tile(138),
                    Tile(131, False),
                    Tile(43),
                    Tile(14),
                ],
                [
                    Tile(55),
                    Tile(134),
                    Tile(106),
                    Tile(39),
                    Tile(109),
                    Tile(31),
                    Tile(18),
                    Tile(151),
                    Tile(96),
                    Tile(26),
                    Tile(154),
                    Tile(2),
                    Tile(91),
                    Tile(153),
                    Tile(117),
                    Tile(39),
                    Tile(119, False),
                    Tile(114),
                    Tile(99),
                    Tile(85),
                ],
                [
                    Tile(109),
                    Tile(13),
                    Tile(64),
                    Tile(89),
                    Tile(53),
                    Tile(58),
                    Tile(12),
                    Tile(61),
                    Tile(38),
                    Tile(1),
                    Tile(57),
                    Tile(135),
                    Tile(79),
                    Tile(79),
                    Tile(121),
                    Tile(28, False),
                    Tile(105),
                    Tile(94),
                    Tile(137),
                    Tile(21),
                ],
                [
                    Tile(97),
                    Tile(74),
                    Tile(30),
                    Tile(118),
                    Tile(94),
                    Tile(67),
                    Tile(138),
                    Tile(41),
                    Tile(20),
                    Tile(100),
                    Tile(124),
                    Tile(49),
                    Tile(142),
                    Tile(90),
                    Tile(138, False),
                    Tile(53),
                    Tile(35),
                    Tile(116),
                    Tile(23),
                    Tile(26),
                ],
                [
                    Tile(43),
                    Tile(62),
                    Tile(81),
                    Tile(35),
                    Tile(13),
                    Tile(151),
                    Tile(87),
                    Tile(72),
                    Tile(13),
                    Tile(58),
                    Tile(93),
                    Tile(86),
                    Tile(143),
                    Tile(78, False),
                    Tile(20),
                    Tile(159),
                    Tile(137),
                    Tile(132),
                    Tile(80),
                    Tile(156),
                ],
                [
                    Tile(98),
                    Tile(101),
                    Tile(123),
                    Tile(154),
                    Tile(51),
                    Tile(140),
                    Tile(14),
                    Tile(56),
                    Tile(49),
                    Tile(48),
                    Tile(71),
                    Tile(87),
                    Tile(49, False),
                    Tile(41),
                    Tile(51),
                    Tile(82),
                    Tile(104),
                    Tile(125),
                    Tile(72),
                    Tile(127),
                ],
                [
                    Tile(122),
                    Tile(105),
                    Tile(39),
                    Tile(54),
                    Tile(120),
                    Tile(41),
                    Tile(81),
                    Tile(70),
                    Tile(11),
                    Tile(155),
                    Tile(98),
                    Tile(52, False),
                    Tile(57),
                    Tile(19),
                    Tile(94),
                    Tile(151),
                    Tile(126),
                    Tile(132),
                    Tile(109),
                    Tile(72),
                ],
                [
                    Tile(47),
                    Tile(98),
                    Tile(142),
                    Tile(146),
                    Tile(137),
                    Tile(29),
                    Tile(94),
                    Tile(156),
                    Tile(39),
                    Tile(109, False),
                    Tile(59),
                    Tile(83),
                    Tile(64),
                    Tile(150),
                    Tile(68),
                    Tile(61),
                    Tile(135),
                    Tile(63),
                    Tile(101),
                    Tile(24),
                ],
                [
                    Tile(33),
                    Tile(92),
                    Tile(115),
                    Tile(86),
                    Tile(111),
                    Tile(56),
                    Tile(121),
                    Tile(51),
                    Tile(33, False),
                    Tile(155),
                    Tile(91),
                    Tile(116),
                    Tile(70),
                    Tile(124),
                    Tile(23),
                    Tile(67),
                    Tile(126),
                    Tile(96),
                    Tile(109),
                    Tile(98),
                ],
                [
                    Tile(136),
                    Tile(109),
                    Tile(38),
                    Tile(132),
                    Tile(84),
                    Tile(40),
                    Tile(119),
                    Tile(61, False),
                    Tile(73),
                    Tile(30),
                    Tile(120),
                    Tile(11),
                    Tile(14),
                    Tile(89),
                    Tile(130),
                    Tile(129),
                    Tile(113),
                    Tile(99),
                    Tile(72),
                    Tile(123),
                ],
                [
                    Tile(64),
                    Tile(145),
                    Tile(72),
                    Tile(135),
                    Tile(38),
                    Tile(91),
                    Tile(91, False),
                    Tile(136),
                    Tile(97),
                    Tile(57),
                    Tile(124),
                    Tile(81),
                    Tile(91),
                    Tile(106),
                    Tile(98),
                    Tile(56),
                    Tile(59),
                    Tile(151),
                    Tile(122),
                    Tile(38),
                ],
                [
                    Tile(114),
                    Tile(61),
                    Tile(151),
                    Tile(48),
                    Tile(39),
                    Tile(80, False),
                    Tile(84),
                    Tile(17),
                    Tile(55),
                    Tile(12),
                    Tile(149),
                    Tile(152),
                    Tile(99),
                    Tile(123),
                    Tile(93),
                    Tile(77),
                    Tile(62),
                    Tile(77),
                    Tile(81),
                    Tile(102),
                ],
                [
                    Tile(130),
                    Tile(86),
                    Tile(66),
                    Tile(37),
                    Tile(44, False),
                    Tile(36),
                    Tile(128),
                    Tile(48),
                    Tile(71),
                    Tile(6),
                    Tile(13),
                    Tile(26),
                    Tile(17),
                    Tile(90),
                    Tile(150),
                    Tile(57),
                    Tile(34),
                    Tile(118),
                    Tile(154),
                    Tile(123),
                ],
            ],
        )

        self.actors[0].setPosition((96, 160))
        self.actors[0].addChild(self.actors[1])
        self.actors[1].animateWithoutMoving = True
        self.actors[1].setRelativePosition((64, -64))

        self._gameMap = GameMap(Tilemap([layer]))
        self._gameMap.setAmbientLight(Color(30, 30, 30, 255))
        self._gameMap.setLights([Light(Vector2f(160, 160), Color(255, 220, 180, 255))])

        self._gameMap.spawnActor(self.actors[0], "default")

    def _logicHandle(self, deltaTime: float) -> None:
        self._gameMap.onTick(deltaTime)
        super()._logicHandle(deltaTime)
        self._gameMap.onLateTick(deltaTime)

    def _renderHandle(self, deltaTime: float) -> None:
        self._gameMap.show()
        super()._renderHandle(deltaTime)
