# -*- encoding: utf-8 -*-

import Engine.Manager as Manager
from Engine import Vector2f, seconds, Color
from Engine.Gameplay import SceneBase
from Engine.Gameplay.Actors import Character
from Engine.Gameplay import Tile, TileLayer, Tilemap, Light, GameMap


class Scene(SceneBase):
    def onCreate(self):
        self.actors = [
            Character(Manager.loadCharacter("actors/classic-cha-braver01.png"), "yongshi"),
            Character(Manager.loadCharacter("actors/020-Braver10.png"), "shilaimu"),
        ]
        for i, actor in enumerate(self.actors):
            actor.setAnimatable(True, True)

        layer = TileLayer(
            "default",
            "magictower.png",
            [
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(6, False),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(6, False),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
                [
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(6, False),
                    Tile(6, False),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                    Tile(0),
                ],
            ],
        )

        self.actors[0].setCollisionEnabled(True)
        self.actors[0].setPosition((160, 160))
        self.actors[0].addChild(self.actors[1])
        self.actors[1].animateWithoutMoving = True
        self.actors[1].setRelativePosition((64, -64))

        self._gameMap = GameMap(Tilemap([layer]))
        self._gameMap.setAmbientLight(Color(30, 30, 30, 255))
        self._gameMap.setLights([Light(Vector2f(320, 240), Color(255, 220, 180, 255), 256.0)])

        self._gameMap.spawnActor(self.actors[0], "default")

    def _logicHandle(self, deltaTime: float) -> None:
        self._gameMap.onTick(deltaTime)
        super()._logicHandle(deltaTime)
        self._gameMap.onLateTick(deltaTime)

    def _renderHandle(self, deltaTime: float) -> None:
        self._gameMap.show()
        super()._renderHandle(deltaTime)
